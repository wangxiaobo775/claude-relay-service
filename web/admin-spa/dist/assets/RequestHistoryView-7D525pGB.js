import{r as u,q as J,x as d,z as t,L as k,K as h,aV as N,Q as T,ac as A,aq as R,O as f,C as m,P as r,Y as z,y as n}from"./vue-vendor-Bsazo-x0.js";import{_ as L,c as w}from"./index-CbH8DTEo.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const U={class:"request-history-container"},Y={class:"card mb-6 p-4 sm:p-6"},E={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},Q=["value"],G={class:"flex items-end"},W=["disabled"],X={class:"card p-4 sm:p-6"},Z={key:0,class:"py-12 text-center"},j={key:1,class:"py-12 text-center"},tt={key:2,class:"overflow-x-auto"},et={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},at={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},st={class:"whitespace-nowrap px-4 py-3 text-sm text-gray-900 dark:text-gray-100"},rt={class:"px-4 py-3 text-sm"},lt=["title"],ot={class:"px-4 py-3 text-sm"},dt=["title"],nt={class:"whitespace-nowrap px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},it={class:"whitespace-nowrap px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},ut={class:"whitespace-nowrap px-4 py-3 text-center text-sm"},gt={class:"whitespace-nowrap px-4 py-3 text-center text-sm"},xt=["onClick"],yt={key:3,class:"mt-6 flex flex-col items-center justify-between gap-4 sm:flex-row"},ct={class:"text-sm text-gray-600 dark:text-gray-400"},pt={class:"flex gap-2"},ft=["disabled"],mt=["disabled"],bt={class:"max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white p-6 shadow-xl dark:bg-gray-800"},vt={key:0,class:"space-y-4"},kt={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},ht={class:"grid grid-cols-2 gap-4"},wt={class:"mt-1 font-mono text-sm text-gray-900 dark:text-gray-100"},_t={class:"mt-1 text-sm font-medium text-gray-900 dark:text-gray-100"},St={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},It={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},Ct={class:"mt-1"},Kt={class:"mt-1 text-sm text-gray-900 dark:text-gray-100"},qt={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Nt={class:"grid grid-cols-2 gap-4 sm:grid-cols-4"},Tt={class:"mt-1 text-lg font-bold text-blue-600"},At={class:"mt-1 text-lg font-bold text-green-600"},Mt={class:"mt-1 text-lg font-bold text-purple-600"},Pt={class:"mt-1 text-lg font-bold text-purple-600"},Dt={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Vt={class:"max-h-60 overflow-auto rounded bg-gray-800 p-3 text-xs text-green-400"},$t={class:"rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Ft={class:"max-h-60 overflow-auto rounded bg-gray-800 p-3 text-xs text-blue-400"},Ot={key:0,class:"rounded-lg bg-red-50 p-4 dark:bg-red-900/20"},Bt={class:"text-sm text-red-800 dark:text-red-400"},Ht={key:1,class:"py-8 text-center"},Jt={__name:"RequestHistoryView",setup(Rt){const c=u(!1),g=u([]),_=u([]),b=u(!1),l=u(null),i=u({apiKeyId:"",date:new Date().toISOString().split("T")[0],status:""}),o=u({page:1,limit:50,total:0}),v=u(!1);async function M(){try{const a=await w.get("/admin/api-keys");a.success&&(_.value=a.data.keys||[])}catch(a){console.error("Failed to load API keys:",a)}}async function x(){var a,e;c.value=!0;try{const s={limit:o.value.limit,offset:(o.value.page-1)*o.value.limit};i.value.apiKeyId&&(s.apiKeyId=i.value.apiKeyId),i.value.date&&(s.date=i.value.date),i.value.status&&(s.status=i.value.status);const y=await w.get("/admin/request-history",{params:s});y.success&&(g.value=y.data.history||[],v.value=((a=y.data.pagination)==null?void 0:a.hasMore)||!1,o.value.total=((e=y.data.pagination)==null?void 0:e.total)||g.value.length)}catch(s){console.error("Failed to load history:",s),g.value=[]}finally{c.value=!1}}async function P(a){b.value=!0,l.value=null;try{const e=await w.get(`/admin/request-history/${a}`);e.success&&(l.value=e.data.request)}catch(e){console.error("Failed to load request details:",e)}}function S(){b.value=!1,l.value=null}function D(){v.value&&(o.value.page++,x())}function V(){o.value.page>1&&(o.value.page--,x())}function I(a){if(!a)return"N/A";const e=new Date(a),s=e.getFullYear(),y=String(e.getMonth()+1).padStart(2,"0"),F=String(e.getDate()).padStart(2,"0"),O=String(e.getHours()).padStart(2,"0"),B=String(e.getMinutes()).padStart(2,"0"),H=String(e.getSeconds()).padStart(2,"0");return`${s}-${y}-${F} ${O}:${B}:${H}`}function p(a){return a>=1e6?(a/1e6).toFixed(2)+"M":a>=1e3?(a/1e3).toFixed(2)+"K":a.toString()}function C(a){if(!a)return"N/A";if(typeof a=="string")try{return JSON.stringify(JSON.parse(a),null,2)}catch{return a}return JSON.stringify(a,null,2)}function K(a){switch(a){case"completed":case"success":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"failed":case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}function $(a){switch(a){case"completed":case"success":return"fa-check-circle";case"failed":case"error":return"fa-times-circle";case"pending":return"fa-clock";default:return"fa-question-circle"}}function q(a){switch(a){case"completed":return"成功";case"failed":return"失败";case"pending":return"进行中";default:return"未知"}}return J(()=>{M(),x()}),(a,e)=>(n(),d("div",U,[e[32]||(e[32]=t("div",{class:"mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"请求历史记录"),t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 查看所有 API 请求的详细历史记录，包括输入、输出和 Token 使用情况 ")],-1)),t("div",Y,[t("div",E,[t("div",null,[e[4]||(e[4]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),h(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.value.apiKeyId=s),class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-blue-400 dark:focus:ring-blue-800",onChange:x},[e[3]||(e[3]=t("option",{value:""},"全部 API Keys",-1)),(n(!0),d(T,null,A(_.value,s=>(n(),d("option",{key:s.id,value:s.id},r(s.name),9,Q))),128))],544),[[N,i.value.apiKeyId]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 日期 ",-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.date=s),class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-blue-400 dark:focus:ring-blue-800",type:"date",onChange:x},null,544),[[R,i.value.date]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态 ",-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.status=s),class:"w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-blue-400 dark:focus:ring-blue-800",onChange:x},e[6]||(e[6]=[t("option",{value:""},"全部状态",-1),t("option",{value:"success"},"成功",-1),t("option",{value:"error"},"失败",-1),t("option",{value:"pending"},"进行中",-1)]),544),[[N,i.value.status]])]),t("div",G,[t("button",{class:"w-full rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",disabled:c.value,onClick:x},[t("i",{class:m(["fas fa-sync-alt mr-2",{"animate-spin":c.value}])},null,2),f(" "+r(c.value?"加载中...":"刷新"),1)],8,W)])])]),t("div",X,[c.value&&g.value.length===0?(n(),d("div",Z,e[8]||(e[8]=[t("i",{class:"fas fa-spinner fa-spin text-4xl text-blue-500"},null,-1),t("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"加载中...",-1)]))):g.value.length===0?(n(),d("div",j,e[9]||(e[9]=[t("i",{class:"fas fa-inbox text-6xl text-gray-300 dark:text-gray-600"},null,-1),t("p",{class:"mt-4 text-lg text-gray-600 dark:text-gray-400"},"暂无请求历史记录",-1),t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-500"}," 当有新的 API 请求时，历史记录会显示在这里 ",-1)]))):(n(),d("div",tt,[t("table",et,[e[11]||(e[11]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 时间 "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," API Key "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 模型 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 输入 Tokens "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 输出 Tokens "),t("th",{class:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 状态 "),t("th",{class:"px-4 py-3 text-center text-xs font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300"}," 操作 ")])],-1)),t("tbody",at,[(n(!0),d(T,null,A(g.value,s=>(n(),d("tr",{key:s.requestId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",st,r(I(s.timestamp)),1),t("td",rt,[t("span",{class:"inline-block max-w-[150px] truncate font-medium text-blue-600 dark:text-blue-400",title:s.apiKeyName},r(s.apiKeyName),9,lt)]),t("td",ot,[t("span",{class:"inline-block max-w-[200px] truncate text-gray-700 dark:text-gray-300",title:s.model},r(s.model||"N/A"),9,dt)]),t("td",nt,r(p(s.inputTokens||0)),1),t("td",it,r(p(s.outputTokens||0)),1),t("td",ut,[t("span",{class:m(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",K(s.status)])},[t("i",{class:m(["fas mr-1",$(s.status)])},null,2),f(" "+r(q(s.status)),1)],2)]),t("td",gt,[t("button",{class:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:y=>P(s.requestId)},e[10]||(e[10]=[t("i",{class:"fas fa-eye"},null,-1),t("span",{class:"ml-1"},"详情",-1)]),8,xt)])]))),128))])])])),g.value.length>0?(n(),d("div",yt,[t("div",ct," 显示 "+r((o.value.page-1)*o.value.limit+1)+" 到 "+r(Math.min(o.value.page*o.value.limit,o.value.total))+" 条，共 "+r(o.value.total)+" 条记录 ",1),t("div",pt,[t("button",{class:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:o.value.page<=1,onClick:V},e[12]||(e[12]=[t("i",{class:"fas fa-chevron-left"},null,-1),f(" 上一页 ",-1)]),8,ft),t("button",{class:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:!v.value,onClick:D},e[13]||(e[13]=[f(" 下一页 ",-1),t("i",{class:"fas fa-chevron-right"},null,-1)]),8,mt)])])):k("",!0)]),b.value?(n(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:z(S,["self"])},[t("div",bt,[t("div",{class:"mb-4 flex items-center justify-between"},[e[15]||(e[15]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"请求详情",-1)),t("button",{class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:S},e[14]||(e[14]=[t("i",{class:"fas fa-times text-xl"},null,-1)]))]),l.value?(n(),d("div",vt,[t("div",kt,[e[22]||(e[22]=t("h4",{class:"mb-3 font-semibold text-gray-900 dark:text-gray-100"},"基本信息",-1)),t("div",ht,[t("div",null,[e[16]||(e[16]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"请求 ID:",-1)),t("p",wt,r(l.value.requestId),1)]),t("div",null,[e[17]||(e[17]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Key:",-1)),t("p",_t,r(l.value.apiKeyName),1)]),t("div",null,[e[18]||(e[18]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"模型:",-1)),t("p",St,r(l.value.model),1)]),t("div",null,[e[19]||(e[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"时间:",-1)),t("p",It,r(I(l.value.timestamp)),1)]),t("div",null,[e[20]||(e[20]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"状态:",-1)),t("p",Ct,[t("span",{class:m(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",K(l.value.status)])},r(q(l.value.status)),3)])]),t("div",null,[e[21]||(e[21]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"状态码:",-1)),t("p",Kt,r(l.value.statusCode||"N/A"),1)])])]),t("div",qt,[e[27]||(e[27]=t("h4",{class:"mb-3 font-semibold text-gray-900 dark:text-gray-100"},"Token 使用统计",-1)),t("div",Nt,[t("div",null,[e[23]||(e[23]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入:",-1)),t("p",Tt,r(p(l.value.inputTokens||0)),1)]),t("div",null,[e[24]||(e[24]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出:",-1)),t("p",At,r(p(l.value.outputTokens||0)),1)]),t("div",null,[e[25]||(e[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存创建:",-1)),t("p",Mt,r(p(l.value.cacheCreateTokens||0)),1)]),t("div",null,[e[26]||(e[26]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存读取:",-1)),t("p",Pt,r(p(l.value.cacheReadTokens||0)),1)])])]),t("div",Dt,[e[28]||(e[28]=t("h4",{class:"mb-3 font-semibold text-gray-900 dark:text-gray-100"},"请求内容",-1)),t("pre",Vt,[t("code",null,r(C(l.value.requestBody)),1)])]),t("div",$t,[e[29]||(e[29]=t("h4",{class:"mb-3 font-semibold text-gray-900 dark:text-gray-100"},"响应内容",-1)),t("pre",Ft,[t("code",null,r(C(l.value.responseBody)),1)])]),l.value.error?(n(),d("div",Ot,[e[30]||(e[30]=t("h4",{class:"mb-3 font-semibold text-red-900 dark:text-red-300"},"错误信息",-1)),t("p",Bt,r(l.value.error),1)])):k("",!0)])):(n(),d("div",Ht,e[31]||(e[31]=[t("i",{class:"fas fa-spinner fa-spin text-4xl text-blue-500"},null,-1),t("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"加载详情中...",-1)])))])])):k("",!0)]))}},Et=L(Jt,[["__scopeId","data-v-2bb64b7b"]]);export{Et as default};
